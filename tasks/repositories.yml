#Debian 11 (bullseye) Repositories
- name: Add tailscale repo on Debian 11 (x64)
  block:
    - name: Tailscale debian signing key
      get_url:
        url: https://pkgs.tailscale.com/stable/debian/bullseye.noarmor.gpg
        dest: /usr/share/keyrings/tailscale-archive-keyring.gpg
    - name: Tailscale debian repository
      apt_repository:
        repo: "deb [signed-by=/usr/share/keyrings/tailscale-archive-keyring.gpg] https://pkgs.tailscale.com/stable/debian bullseye main"
        state: present
  when:
    - ansible_distribution_release == "bullseye"
    - ansible_machine == "x86_64"

#Ubuntu 22.04 LTS Repositories
- name: Add tailscale repo on Ubuntu 22.04 LTS (x64)
  block:
    #tailscale
    - name: Tailscale Ubuntu signing key
      get_url:
        url: https://pkgs.tailscale.com/stable/ubuntu/jammy.noarmor.gpg
        dest: /usr/share/keyrings/tailscale-archive-keyring.gpg
    - name: Tailscale Ubuntu repository
      apt_repository:
        repo: "deb [signed-by=/usr/share/keyrings/tailscale-archive-keyring.gpg] https://pkgs.tailscale.com/stable/ubuntu jammy main"
        state: present
    
    #docker engine
    - name: Docker signing key
      get_url:
        url: https://download.docker.com/linux/ubuntu/gpg
        dest: /usr/share/keyrings/docker.gpg
        mode: '0444'
    - name: Add the Docker repo
      apt_repository:
        repo: "deb [arch=amd64 signed-by=/usr/share/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu jammy stable"
        state: present
  when:
    - ansible_distribution == "Ubuntu"
    - ansible_distribution_release == "jammy"
    - ansible_machine == "x86_64"